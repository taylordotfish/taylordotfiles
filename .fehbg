#!/bin/sh
# Copyright (C) 2024 taylor.fish <contact@taylor.fish>
# License: GNU GPL version 3 or later
set -eu

. ~/scripts/monitor-utils.sh

image_1=/etc/alternatives/desktop-theme/wallpaper/contents/images/1920x1080.svg

IFS='
'
for line in $(monitors); do
    index=$(printf '%s\n' "$line" | cut -f1)
    priority=$(printf '%s\n' "$line" | cut -f7)
    properties=$(printf '%s\n' "$line" | cut -f8)
    eval "image=\${image_$priority-\$image_1}"
    if printf '%s\n' "$properties" | grep '\bmono\b' > /dev/null; then
        [ -n "$image_mono" ] && image=$image_mono
    fi
    eval "mimage_$index=\$image"
done

args=
i=0
while true; do
    eval "mimage=\${mimage_$i-}"
    [ -z "$mimage" ] && break
    args="$args \"\$mimage_$i\""
    i=$((i+1))
done

eval "feh --no-fehbg --bg-fill $args"
