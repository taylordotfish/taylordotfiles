#!/bin/sh
# Copyright (C) 2024 taylor.fish <contact@taylor.fish>
# License: GNU GPL version 3 or later
set -eu

. ~/scripts/monitor-utils.sh

parse() {
    index=$1
    width=$2
    height=$3
    posx=$4
    posy=$5
}

set -f
fullwidth=0
fullheight=0
IFS='
'
for line in $(monitors); do
    width=$(printf '%s\n' "$line" | cut -f2)
    height=$(printf '%s\n' "$line" | cut -f3)
    posx=$(printf '%s\n' "$line" | cut -f4)
    posy=$(printf '%s\n' "$line" | cut -f5)
    right=$((posx+width))
    bottom=$((posy+height))
    [ "$right" -gt "$fullwidth" ] && fullwidth=$right
    [ "$bottom" -gt "$fullheight" ] && fullheight=$bottom
done

im_args=
for line in $(monitors); do
    width=$(printf '%s\n' "$line" | cut -f2)
    height=$(printf '%s\n' "$line" | cut -f3)
    posx=$(printf '%s\n' "$line" | cut -f4)
    posy=$(printf '%s\n' "$line" | cut -f5)
    im_args="$im_args -draw 'rectangle $posx,0 $((posx+width)),$posy'"
    im_args="$im_args -draw 'rectangle $posx,$((posy+height))"
    im_args="$im_args $((posx+width)),$fullheight'"
done

fullsize="$fullwidth"x"$fullheight"
scrot=$(PATH=/usr/bin:/usr/local/bin which scrot)
"$scrot" -e "\
[ \"\\\$(identify -format '%%wx%%h' '\$f')\" = \"$fullsize\" ] && \
mogrify -fill white $im_args -alpha off '\$f'" "$@"
