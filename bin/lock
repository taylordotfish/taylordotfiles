#!/bin/sh
set -eu

[ -f ~/.config/monitor-order ] && . ~/.config/monitor-order

if [ -d ~/.cache/i3lock-screenshots ]; then
    cd ~/.cache/i3lock-screenshots
    rm -f *.png
    for i in $(xrandr --listactivemonitors | grep -o '^\s*[0-9]*'); do
        scrot -M "$i" "screen$i.png"
    done
    convert $(ls -v screen*.png) -blur 10x10 +append full.png
    i3lock -i full.png
    rm screen*.png
    exit
fi

if [ -n "${MONOCHROME-}" ]; then
    i3lock -c ffffff
else
    i3lock -c 000000
fi
